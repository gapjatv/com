<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°‘ìTV ì‹œì°¸ ì‹ ì²­</title>
    <style>
        body {
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            background-color: #121212; color: white;
            display: flex; flex-direction: column; align-items: center;
            justify-content: flex-start; padding-top: 10vh;
            min-height: 100vh; margin: 0; text-align: center; box-sizing: border-box;
        }
        .container {
            width: 85%; max-width: 380px; padding: 30px 20px; 
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px; border: 3px solid #ffcc00; 
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.2);
            box-sizing: border-box; transition: all 0.3s ease;
        }
        
        .header-container { position: relative; width: 100%; text-align: center; margin-bottom: 10px; }
        .live-status-text { position: absolute; top: 0; left: 0; font-size: 0.8rem; font-weight: bold; color: #6c757d; cursor: default; white-space: nowrap; }
        .title-logo { width: 90px; height: auto; margin-top: 15px; margin-bottom: 5px; filter: drop-shadow(0 0 5px rgba(255,204,0,0.5)); }
        
        h1 { color: #ffcc00; margin: 0 0 10px 0; font-size: 1.5rem; line-height: 1.4; }
        .waiting-status {
            background: rgba(255, 204, 0, 0.1); color: #ffcc00;
            padding: 8px 15px; border-radius: 50px; font-size: 0.85rem;
            display: inline-block; margin-bottom: 20px; font-weight: bold;
        }
        #liveClock { color: #ffcc00; font-size: 1.1rem; font-weight: bold; margin-bottom: 25px; letter-spacing: 1px; }
        
        .input-group {
            display: flex; gap: 8px; margin-bottom: 15px; width: 100%;
        }
        input {
            flex: 6; min-width: 0; padding: 15px; margin-bottom: 0; 
            border-radius: 10px; border: 1px solid #555;
            background: #222; color: white; font-size: 1.1rem;
            box-sizing: border-box; text-align: center;
        }
        select {
            flex: 4; min-width: 0; padding: 15px 5px; border-radius: 10px; border: 1px solid #555;
            background: #222; color: #ffcc00; font-size: 0.95rem; font-weight: bold;
            box-sizing: border-box; cursor: pointer; text-align: center;
        }

        button.main-btn {
            width: 100%; padding: 15px; border-radius: 10px; border: none;
            background: #ffcc00; color: #000; font-size: 1.2rem; font-weight: 900; 
            cursor: pointer; box-shadow: 0 4px 10px rgba(255, 204, 0, 0.3);
            transition: transform 0.1s;
        }
        button.main-btn:active { transform: scale(0.98); }
        button.main-btn:disabled { background: #555; color: #888; cursor: not-allowed; }
        
        .donate-btn-group { display: flex; gap: 10px; margin-bottom: 20px; width: 100%; }
        .donate-btn {
            flex: 1; padding: 12px 0; border-radius: 8px; border: none; font-weight: bold; font-size: 0.85rem; letter-spacing: -0.5px; white-space: nowrap; cursor: pointer; color: white; transition: transform 0.1s;
        }
        .donate-btn:active { transform: scale(0.95); }
        .btn-toon { background: linear-gradient(to right, #00a8ff, #0097e6); box-shadow: 0 3px 8px rgba(0, 168, 255, 0.4); }
        .btn-bank { background: linear-gradient(to right, #4CAF50, #388E3C); box-shadow: 0 3px 8px rgba(76, 175, 80, 0.4); }

        .cooldown-msg { color: #ff4444; font-size: 0.8rem; margin-top: 10px; display: none; }
        
        #successSection, #prioritySection, #prioritySuccessSection { display: none; }
        .success-icon { font-size: 4rem; color: #ffcc00; margin-bottom: 20px; }
        
        .footer-link { margin-top: 20px; font-size: 0.8rem; color: #666; cursor: pointer; text-decoration: underline; transition: color 0.2s; font-family: 'Pretendard', 'Malgun Gothic', sans-serif;}
        .footer-link:hover { color: #ffcc00; }
        .back-link { margin-top: 20px; font-size: 0.85rem; color: #aaa; text-decoration: underline; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        
        <div id="formSection">
            
            <div class="header-container">
                <div id="liveStatusText" class="live-status-text">âšª ë¼ì´ë¸Œ(ì¤€ë¹„ì¤‘)</div>
                <img src="https://tistory1.daumcdn.net/tistory/4488967/skin/images/gajayu.png" class="title-logo">
            </div>

            <h1>ê°‘ìTV ì‹œì°¸ ì‹ ì²­</h1>
            <div class="waiting-status">ğŸ”¥í˜„ì¬ ì°¸ì—¬ì : <span id="waitingCount">í™•ì¸ì¤‘...</span></div>
            <div id="liveClock">0000ë…„ 00ì›” 00ì¼ 00:00:00</div>
            
            <div class="input-group">
                <input type="text" id="nickname" placeholder="ê²Œì„ ë‹‰ë„¤ì„ ì…ë ¥">
                <select id="modeSelect" onchange="checkPrioritySelect()">
                    <option value="íƒœì´ˆ">íƒœì´ˆ</option>
                    <option value="ì‹ ">ì‹ </option>
                    <option value="ìš°ì„ ì˜ˆì•½">ìš°ì„ ì˜ˆì•½</option>
                </select>
            </div>
            
            <button id="submitBtn" class="main-btn" onclick="sendData()">ğŸš€ ì‹ ì²­í•˜ê¸°</button>
            <div id="cooldownMsg" class="cooldown-msg">ë„ë°° ë°©ì§€ë¥¼ ìœ„í•´ ì ì‹œ í›„ ë‹¤ì‹œ ì‹ ì²­ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
            
            <div class="footer-link" onclick="window.open('https://toon.at/donate/gapjatv', '_blank')">í›„ì›í•˜ê¸°</div>
        </div>

        <div id="successSection">
            <div class="success-icon">
                <img src="https://tistory1.daumcdn.net/tistory/4488967/skin/images/beullob.png" style="width: 150px; height: auto; filter: drop-shadow(0 0 10px rgba(255,204,0,0.5));">
            </div>
            <h1 style="color: white;">ì‹ ì²­ ì™„ë£Œ!</h1>
            <p style="color: #ffcc00; font-weight: bold;">ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <p>ë°©ì†¡ì„ ë³´ë©° ìˆœì„œë¥¼ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!</p>
            <button onclick="location.reload()" style="background: #333; color: #fff; font-size: 0.9rem; padding: 10px; margin-top: 20px; border-radius: 8px; border:none; cursor:pointer;">ì²˜ìŒìœ¼ë¡œ</button>
        </div>

        <div id="prioritySection">
            <img src="https://tistory1.daumcdn.net/tistory/4488967/skin/images/gajayu.png" class="title-logo" style="display: block; margin: 0 auto 10px auto; width: 90px; margin-top: 0;">
            <h1>ê°‘ìáµ—áµ› í›„ì› ë° ìš°ì„ ì˜ˆì•½</h1>
            
            <div class="donate-btn-group">
                <button class="donate-btn btn-toon" onclick="window.open('https://toon.at/donate/gapjatv', '_blank')">ğŸ’ íˆ¬ë„¤ì´ì…˜ 5,000ì›</button>
                <button class="donate-btn btn-bank" onclick="copyBankAccount()">ğŸ¦ ê³„ì¢Œí›„ì› 5,000ì›</button>
            </div>

            <div class="input-group">
                <input type="text" id="priorityNickname" placeholder="ê²Œì„ ë‹‰ë„¤ì„ ì…ë ¥">
                <select id="priorityModeSelect">
                    <option value="íƒœì´ˆ">íƒœì´ˆ</option>
                    <option value="ì‹ ">ì‹ </option>
                    <option value="ì§€ì˜¥">ì§€ì˜¥</option>
                    <option value="í•˜ë“œ">í•˜ë“œ</option>
                    <option value="ì¼ë°˜">ì¼ë°˜</option>
                </select>
            </div>
            
            <button id="prioritySubmitBtn" class="main-btn" onclick="sendPriorityData()">ğŸš€ ìš°ì„ ì˜ˆì•½ ì‹ ì²­</button>
            <div id="priorityCooldownMsg" class="cooldown-msg">ë„ë°° ë°©ì§€ë¥¼ ìœ„í•´ 1ë¶„ í›„ ë‹¤ì‹œ ì‹ ì²­ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
            
            <div class="back-link" onclick="goBackToMain()">â† ì¼ë°˜ ì‹œì°¸ ì‹ ì²­ìœ¼ë¡œ ëŒì•„ê°€ê¸°</div>
        </div>

        <div id="prioritySuccessSection">
            <div class="success-icon">
                <img src="https://tistory1.daumcdn.net/tistory/4488967/skin/images/baeteumaen.png" style="width: 170px; height: auto; filter: drop-shadow(0 0 10px rgba(255,204,0,0.5));">
            </div>
            <h1 style="color: white;">ìš°ì„ ì˜ˆì•½ ì™„ë£Œ!</h1>
            <p style="color: #ffcc00; font-weight: bold; font-size: 1.2rem;">ìš°ì„ ì˜ˆì•½ ì™„ë£Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <p style="line-height: 1.6;">ì†Œì¤‘í•œ í›„ì› ì •ë§ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤!<br>ë°©ì†¡ í™”ë©´ì—ì„œ ë°”ë¡œ í™•ì¸í•´ ë“œë¦´ê²Œìš”! ğŸ’–</p>
            <button onclick="location.reload()" style="background: #333; color: #fff; font-size: 0.9rem; padding: 10px; margin-top: 20px; border-radius: 8px; border:none; cursor:pointer;">ì²˜ìŒìœ¼ë¡œ</button>
        </div>

    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbyyJuoBA7A-mzqmBHdV52HBYB21K__bWa_MMHPUDI1rMn7bpzO_uAJbAeBS8XPdhGOb/exec"; 
        const COOLDOWN_TIME = 5 * 60 * 1000;          
        const PRIORITY_COOLDOWN_TIME = 1 * 60 * 1000; 

        function updateClock() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('liveClock').innerText = `${year}ë…„ ${month}ì›” ${day}ì¼ ${hours}:${minutes}:${seconds}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        function fetchWaitingCount() {
            fetch(GAS_URL)
                .then(res => res.json())
                .then(data => {
                    // [ìˆ˜ì •ë¨] ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ë©´ "Oëª…"ìœ¼ë¡œ ì¶œë ¥ë˜ë„ë¡ ë³€ê²½
                    document.getElementById('waitingCount').innerText = (data.count || 0) + "ëª…";
                    updateLiveStatus(data.isLive === true);
                })
                .catch(() => {
                    document.getElementById('waitingCount').innerText = "0ëª…";
                    updateLiveStatus(false);
                });
        }

        function updateLiveStatus(isOnline) {
            const statusText = document.getElementById('liveStatusText');
            if(isOnline) {
                statusText.innerText = "ğŸ”µ ë¼ì´ë¸Œ(ì§„í–‰ì¤‘)";
                statusText.style.color = "#007bff"; 
            } else {
                statusText.innerText = "âšª ë¼ì´ë¸Œ(ì¤€ë¹„ì¤‘)";
                statusText.style.color = "#6c757d"; 
            }
        }

        function checkCooldown() {
            const lastSubmit = localStorage.getItem('lastSubmitTime');
            if (lastSubmit) {
                if (Date.now() - parseInt(lastSubmit) < COOLDOWN_TIME) {
                    const btn = document.getElementById('submitBtn');
                    btn.disabled = true;
                    document.getElementById('cooldownMsg').style.display = 'block';
                    btn.innerText = "ì ì‹œ í›„ ì‹ ì²­ ê°€ëŠ¥";
                }
            }

            const lastPrioritySubmit = localStorage.getItem('lastPrioritySubmitTime');
            if (lastPrioritySubmit) {
                if (Date.now() - parseInt(lastPrioritySubmit) < PRIORITY_COOLDOWN_TIME) {
                    const pBtn = document.getElementById('prioritySubmitBtn');
                    pBtn.disabled = true;
                    document.getElementById('priorityCooldownMsg').style.display = 'block';
                    pBtn.innerText = "ì ì‹œ í›„ ì‹ ì²­ ê°€ëŠ¥";
                }
            }
        }

        function checkPrioritySelect() {
            const mode = document.getElementById('modeSelect').value;
            if (mode === "ìš°ì„ ì˜ˆì•½") {
                document.getElementById('formSection').style.display = 'none';
                document.getElementById('prioritySection').style.display = 'block';
                document.getElementById('modeSelect').value = "íƒœì´ˆ"; 
            }
        }

        function goBackToMain() {
            document.getElementById('prioritySection').style.display = 'none';
            document.getElementById('formSection').style.display = 'block';
        }

        function copyBankAccount() {
            const accountInfo = "3333-11-6729871"; 
            navigator.clipboard.writeText(accountInfo).then(() => {
                alert("ì¹´ì¹´ì˜¤ë±…í¬ 3333-11-6729871 (ì˜ˆê¸ˆì£¼: ë°±**)\n\nâœ… ê³„ì¢Œë²ˆí˜¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\nì†Œì¤‘í•œ í›„ì› ì •ë§ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤!");
            }).catch(err => {
                alert("ì¹´ì¹´ì˜¤ë±…í¬ 3333-11-6729871 (ì˜ˆê¸ˆì£¼: ë°±**)\n\nì†Œì¤‘í•œ í›„ì› ì •ë§ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤!");
            });
        }

        function sendData() {
            const input = document.getElementById('nickname');
            const mode = document.getElementById('modeSelect').value; 
            const btn = document.getElementById('submitBtn');
            const name = input.value.trim();

            if (!name) return alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");

            btn.disabled = true;
            btn.innerText = "ì „ì†¡ ì¤‘...";
            const combinedNickname = name + " [" + mode + "]";

            fetch(GAS_URL, {
                method: "POST", mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ nickname: combinedNickname }) 
            })
            .then(() => {
                localStorage.setItem('lastSubmitTime', Date.now());
                document.getElementById('formSection').style.display = 'none';
                document.getElementById('successSection').style.display = 'block';
            })
            .catch(() => {
                alert("ì˜¤ë¥˜ ë°œìƒ! ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                btn.disabled = false;
                btn.innerText = "ğŸš€ ì‹ ì²­í•˜ê¸°";
            });
        }

        function sendPriorityData() {
            const input = document.getElementById('priorityNickname');
            const mode = document.getElementById('priorityModeSelect').value; 
            const btn = document.getElementById('prioritySubmitBtn');
            const name = input.value.trim();

            if (!name) return alert("ê²Œì„ ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");

            btn.disabled = true;
            btn.innerText = "ì „ì†¡ ì¤‘...";
            const combinedNickname = name + " [ìš°ì„ ì˜ˆì•½-" + mode + "]";

            fetch(GAS_URL, {
                method: "POST", mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ nickname: combinedNickname }) 
            })
            .then(() => {
                localStorage.setItem('lastPrioritySubmitTime', Date.now());
                document.getElementById('prioritySection').style.display = 'none';
                document.getElementById('prioritySuccessSection').style.display = 'block';
            })
            .catch(() => {
                alert("ì˜¤ë¥˜ ë°œìƒ! ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                btn.disabled = false;
                btn.innerText = "ğŸš€ ìš°ì„ ì˜ˆì•½ ì‹ ì²­";
            });
        }

        window.onload = () => { fetchWaitingCount(); checkCooldown(); };
    </script>
</body>
</html>
