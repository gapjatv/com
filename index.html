<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°‘ìTV ì‹œì°¸ ì‹ ì²­</title>
    <style>
        body {
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            background-color: #121212; color: white;
            display: flex; flex-direction: column; align-items: center;
            justify-content: flex-start; padding-top: 10vh;
            min-height: 100vh; margin: 0; text-align: center; box-sizing: border-box;
        }
        
        .container {
            width: 85%; max-width: 380px; padding: 30px 20px; 
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px; border: 3px solid #ffcc00; /* ë©”ì¸ ë…¸ë€ìƒ‰ í…Œë‘ë¦¬ */
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.2);
            box-sizing: border-box; transition: all 0.3s ease;
        }

        .title-logo { width: 80px; height: auto; margin-bottom: 10px; filter: drop-shadow(0 0 5px rgba(255,204,0,0.5)); }
        h1 { color: #ffcc00; margin: 0 0 10px 0; font-size: 1.5rem; line-height: 1.4; }
        
        .waiting-status {
            background: rgba(255, 204, 0, 0.1); color: #ffcc00;
            padding: 8px 15px; border-radius: 50px; font-size: 0.85rem;
            display: inline-block; margin-bottom: 20px; font-weight: bold;
        }

        /* ì‹¤ì‹œê°„ ì‹œê³„ ìŠ¤íƒ€ì¼ */
        #liveClock { color: #ffcc00; font-size: 1.1rem; font-weight: bold; margin-bottom: 25px; letter-spacing: 1px; }
        
        input {
            width: 100%; padding: 15px; margin-bottom: 15px;
            border-radius: 10px; border: 1px solid #555;
            background: #222; color: white; font-size: 1.1rem;
            box-sizing: border-box; text-align: center;
        }
        
        button {
            width: 100%; padding: 15px; border-radius: 10px; border: none;
            background: #ffcc00; color: #000; font-size: 1.2rem; font-weight: 900; 
            cursor: pointer; box-shadow: 0 4px 10px rgba(255, 204, 0, 0.3);
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.98); }
        button:disabled { background: #555; color: #888; cursor: not-allowed; }
        
        #cooldownMsg { color: #ff4444; font-size: 0.8rem; margin-top: 10px; display: none; }

        /* ì‹ ì²­ ì™„ë£Œ í™”ë©´ */
        #successSection { display: none; }
        .success-icon { font-size: 4rem; color: #ffcc00; margin-bottom: 20px; }

        .footer { margin-top: 20px; font-size: 0.8rem; color: #666; }
    </style>
</head>
<body>

    <div class="container" id="mainContainer">
        <div id="formSection">
            <img src="https://tistory1.daumcdn.net/tistory/4488967/skin/images/gajayu.png" class="title-logo">
            <h1>ê°‘ìTV ì‹œì°¸ ì‹ ì²­</h1>
            <div class="waiting-status">ğŸ”¥ ìµœê·¼ 1ì‹œê°„ ëŒ€ê¸°: <span id="waitingCount">?</span>ëª…</div>

            <div id="liveClock">0000ë…„ 00ì›” 00ì¼ 00:00:00</div>
            
            <input type="text" id="nickname" placeholder="ê²Œì„ ë‹‰ë„¤ì„ ì…ë ¥">
            <button id="submitBtn" onclick="sendData()">ğŸš€ ì‹ ì²­í•˜ê¸°</button>
            <div id="cooldownMsg">ë„ë°° ë°©ì§€ë¥¼ ìœ„í•´ ì ì‹œ í›„ ë‹¤ì‹œ ì‹ ì²­ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
            <div class="footer">ë°©ì†¡ í™”ë©´ì˜ ëŒ€ê¸° ëª…ë‹¨ì„ í™•ì¸í•˜ì„¸ìš”!</div>
        </div>

        <div id="successSection">
            <div class="success-icon">âœ…</div>
            <h1 style="color: white;">ì‹ ì²­ ì™„ë£Œ!</h1>
            <p style="color: #ffcc00; font-weight: bold;">ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <p>ë°©ì†¡ì„ ë³´ë©° ìˆœì„œë¥¼ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!</p>
            <button onclick="location.reload()" style="background: #333; color: #fff; font-size: 0.9rem; padding: 10px; margin-top: 20px;">ì²˜ìŒìœ¼ë¡œ</button>
        </div>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbyyJuoBA7A-mzqmBHdV52HBYB21K__bWa_MMHPUDI1rMn7bpzO_uAJbAeBS8XPdhGOb/exec"; 
        const COOLDOWN_TIME = 5 * 60 * 1000; // 5ë¶„

        // 1. ì‹¤ì‹œê°„ ì‹œê³„ ê¸°ëŠ¥
        function updateClock() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            
            document.getElementById('liveClock').innerText = `${year}ë…„ ${month}ì›” ${day}ì¼ ${hours}:${minutes}:${seconds}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // 2. ëŒ€ê¸° ì¸ì› ê°€ì ¸ì˜¤ê¸° (ìµœê·¼ 1ì‹œê°„ í†µê³„)
        function fetchWaitingCount() {
            fetch(GAS_URL)
                .then(res => res.json())
                .then(data => {
                    document.getElementById('waitingCount').innerText = data.count || 0;
                })
                .catch(() => document.getElementById('waitingCount').innerText = "0");
        }

        // 3. ì¿¨íƒ€ì„ ì²´í¬ (ê¸°ê¸°ë³„ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€)
        // IP ì°¨ë‹¨ì€ ì„œë²„ ì„¤ì •ì´ ë³µì¡í•˜ë¯€ë¡œ, ë¸Œë¼ìš°ì € ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
        // ì´ ë°©ì‹ì€ ë‚´ í°ì—ì„œ ì‹ ì²­í•˜ë©´ ë‚˜ë§Œ ë§‰íˆê³ , ë‹¤ë¥¸ ì‚¬ëŒì€ ì•„ë¬´ ìƒê´€ ì—†ì´ ì‹ ì²­ ê°€ëŠ¥í•©ë‹ˆë‹¤.
        function checkCooldown() {
            const lastSubmit = localStorage.getItem('lastSubmitTime');
            if (lastSubmit) {
                const timePassed = Date.now() - parseInt(lastSubmit);
                if (timePassed < COOLDOWN_TIME) {
                    const btn = document.getElementById('submitBtn');
                    btn.disabled = true;
                    document.getElementById('cooldownMsg').style.display = 'block';
                    btn.innerText = "ì ì‹œ í›„ ì‹ ì²­ ê°€ëŠ¥";
                }
            }
        }

        function sendData() {
            const input = document.getElementById('nickname');
            const btn = document.getElementById('submitBtn');
            const name = input.value.trim();

            if (!name) return alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");

            btn.disabled = true;
            btn.innerText = "ì „ì†¡ ì¤‘...";

            fetch(GAS_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ nickname: name })
            })
            .then(() => {
                localStorage.setItem('lastSubmitTime', Date.now()); // ì‹ ì²­í•œ ê¸°ê¸°ì—ë§Œ ì¿¨íƒ€ì„ ì ìš©
                showSuccess();
            })
            .catch(() => {
                alert("ì˜¤ë¥˜ ë°œìƒ! ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                btn.disabled = false;
            });
        }

        function showSuccess() {
            document.getElementById('formSection').style.display = 'none';
            document.getElementById('successSection').style.display = 'block';
            // ì™„ë£Œ í™”ë©´ í…Œë‘ë¦¬ë„ ë…¸ë€ìƒ‰ ìœ ì§€ (ìš”ì²­ì‚¬í•­)
            document.getElementById('mainContainer').style.borderColor = '#ffcc00';
        }

        window.onload = () => { fetchWaitingCount(); checkCooldown(); };
    </script>
</body>
</html>
